var j=Object.create;var O=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var Z=Object.getOwnPropertyNames;var q=Object.getPrototypeOf,z=Object.prototype.hasOwnProperty;var B=(e,t)=>{for(var r in t)O(e,r,{get:t[r],enumerable:!0})},N=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Z(t))!z.call(e,n)&&n!==r&&O(e,n,{get:()=>t[n],enumerable:!(o=W(t,n))||o.enumerable});return e};var G=(e,t,r)=>(r=e!=null?j(q(e)):{},N(t||!e||!e.__esModule?O(r,"default",{value:e,enumerable:!0}):r,e)),H=e=>N(O({},"__esModule",{value:!0}),e);var K={};B(K,{RemoveSubscribe:()=>F,SUSPENSE:()=>i.SUSPENSE,Subscribe:()=>L,bind:()=>U,liftSuspense:()=>i.liftSuspense,shareLatest:()=>w,sinkSuspense:()=>i.sinkSuspense,state:()=>Y,useStateObservable:()=>c,withDefault:()=>i.withDefault});module.exports=H(K);var i=require("@rx-state/core");var u={};var R=require("@rx-state/core");function v(e,t){let o=(0,R.state)(...t===u?[e]:[e,t]);return[(...n)=>c(o(...n)),o]}var E=require("@rx-state/core");function y(e,t){let r=t===u?(0,E.state)(e):(0,E.state)(e,t);return[()=>c(r),r]}function U(e,t){return(typeof e=="function"?v:y)(e,arguments.length>1?t:u)}var d=require("rxjs"),w=()=>(0,d.share)({connector:()=>new d.ReplaySubject(1),resetOnError:!0,resetOnComplete:!0,resetOnRefCountZero:!0});var _=require("@rx-state/core"),k=require("react");var p=require("@rx-state/core"),m=require("react");var x=require("use-sync-external-store/shim");var s=G(require("react")),C=require("rxjs"),g=require("@rx-state/core");var V=(0,s.createContext)(null),{Provider:D}=V,M=()=>(0,s.useContext)(V),I=Promise.resolve(),J=()=>{throw I},L=({source$:e,children:t,fallback:r})=>{let o=(0,s.useRef)();if(!o.current){let a=new C.Subscription;o.current={s:a,u:l=>{let S=u,h=!0;if(a.add((0,g.liftSuspense)()(l).subscribe({error:P=>{if(h){S=P;return}b(()=>{throw P})}})),h=!1,S!==u)throw S}}}let[n,b]=(0,s.useState)(null);if(n!==null&&n!==e)if(e===void 0)b(e);else try{e.getValue(),b(e)}catch(a){}(0,s.useEffect)(()=>{if(b(e),!e)return;let a=(0,g.liftSuspense)()(e).subscribe({error:l=>b(()=>{throw l})});return()=>{a.unsubscribe()}},[e]),(0,s.useEffect)(()=>()=>{var a;(a=o.current)==null||a.s.unsubscribe(),o.current=void 0},[]);let f=n===e?s.default.createElement(D,{value:o.current.u},t):r===void 0?null:s.default.createElement(J,null);return r===void 0?f:s.default.createElement(s.Suspense,{fallback:r},f)},F=({children:e})=>s.default.createElement(D,{value:null},e);var c=e=>{let t=M(),[,r]=(0,m.useState)(),o=(0,m.useRef)();if(!o.current){let b=a=>{let l=a.getValue();if(l instanceof p.StatePromise)throw l.catch(S=>{if(S instanceof p.NoSubscribersError)return S;throw S});return l},f=()=>{let a=o.current.source$;if(!a.getRefCount()&&!a.getDefaultValue){if(!t)throw new Error("Missing Subscribe!");t(a)}return b(a)};o.current={source$:null,args:[,f]}}let n=o.current;return n.source$!==e&&(n.source$=e,n.args[0]=b=>{let f=(0,p.liftSuspense)()(e).subscribe({next:b,error:a=>{r(()=>{throw a})}});return()=>{f.unsubscribe()}}),(0,x.useSyncExternalStore)(...n.args)};var Y=(...e)=>{let t=(0,_.state)(...e);return typeof t=="function"?(...r)=>T(t(...r)):T(t)},A=new WeakMap;function T(e){A.has(e)||A.set(e,(0,k.createElement)(()=>c(e),{}));let t=e.pipeState.bind(e);return Object.assign(e,A.get(e),{pipeState:(...r)=>T(t(...r))})}
//# sourceMappingURL=core.cjs.production.min.js.map
