var y=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var K=Object.getOwnPropertyNames;var M=Object.prototype.hasOwnProperty;var W=(s,e,t)=>e in s?y(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var L=(s,e)=>{for(var t in e)y(s,t,{get:e[t],enumerable:!0})},F=(s,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of K(e))!M.call(s,r)&&r!==t&&y(s,r,{get:()=>e[r],enumerable:!(i=A(e,r))||i.enumerable});return s};var $=s=>F(y({},"__esModule",{value:!0}),s);var a=(s,e,t)=>(W(s,typeof e!="symbol"?e+"":e,t),t);var R={};L(R,{EmptyObservableError:()=>h,NoSubscribersError:()=>f,SUSPENSE:()=>l,StatePromise:()=>d,liftSuspense:()=>N,sinkSuspense:()=>V,state:()=>T,withDefault:()=>C});module.exports=$(R);var l=Symbol("SUSPENSE");var d=class extends Promise{constructor(e){super(e)}};var f=class extends Error{constructor(){super();this.name="NoSubscribersError"}},h=class extends Error{constructor(){super();this.name="EmptyObservableError"}};var u={};var I=require("rxjs");var p=require("rxjs");var S=class extends p.Observable{constructor(e,t,i=p.noop){super(r=>{let n=new p.Subscriber({next:r.next.bind(r),error:r.error.bind(r),complete:p.noop});this.refCount++;let c;r.add(()=>{var o;this.refCount--,c.unsubscribe(),this.refCount===0&&(this.currentValue=u,this.subscription&&this.subscription.unsubscribe(),i(),(o=this.subject)==null||o.complete(),this.subject=null,this.subscription=null,this.promise&&(this.promise.rej(new f),this.promise=null))}),this.subject?(c=this.subject.subscribe(n),this.currentValue!==u&&r.next(this.currentValue)):(this.subject=new p.Subject,c=this.subject.subscribe(n),this.subscription=null,this.subscription=new p.Subscriber({next:o=>{this.promise&&o!==l&&(this.promise.res(o),this.promise=null),this.subject.next(this.currentValue=o)},error:o=>{var m;this.subscription=null;let x=this.subject;this.subject=null,this.currentValue=u;let b=(m=this.promise)==null?void 0:m.rej;b&&o===l&&(this.promise.rej=()=>{b(o)}),x.error(o),b&&this.promise&&(this.promise.rej=b)},complete:()=>{if(this.subscription=null,this.promise&&(this.promise.rej(new h),this.promise=null),this.currentValue!==u)return this.subject.complete();if(t===u){let o=this.subject;return this.subject=null,o.error(new h)}this.subject.next(this.currentValue=t),this.subject.complete()}}),e.subscribe(this.subscription),t!==u&&this.currentValue===u&&this.subject.next(this.currentValue=t))});this.defaultValue=t;a(this,"subject",null);a(this,"subscription",null);a(this,"refCount",0);a(this,"currentValue",u);a(this,"promise",null);a(this,"pipeState",(...e)=>{let t=super.pipe(...e);return t instanceof S?t:new S(t,u)});a(this,"getRefCount",()=>this.refCount);a(this,"getValue",()=>{if(this.promise)return this.promise.p;if(this.currentValue!==u&&this.currentValue!==l)return this.currentValue;if(this.defaultValue!==u)return this.defaultValue;if(this.refCount===0)throw new f;let e=new d((t,i)=>{this.promise={res:t,rej:i,p:null}});return this.promise.p=e,e});a(this,"getDefaultValue",()=>this.defaultValue);t===u&&delete this.getDefaultValue}};function U(s,e){e.getValue=s.getValue,e.getRefCount=s.getRefCount,e.pipeState=s.pipeState,s.getDefaultValue&&(e.getDefaultValue=s.getDefaultValue)}function j(s,e){let t=new D,i=typeof e=="function"?e:()=>e,r=n=>{for(let E=n.length-1;n[E]===void 0&&E>-1;E--)n.splice(-1);let c=[n.length,...n],o=t.get(c);if(o!==void 0)return o;let x=new S(s(...n),i(...n),()=>{t.delete(c)}),b=new I.Observable(E=>{let P=t.get(c),g=x;return P?P!==b&&(g=P,U(g,b)):t.set(c,m),g.subscribe(E)});U(x,b);let m=b;return t.set(c,m),m};return(...n)=>r(n)}var D=class{constructor(){a(this,"root");this.root=new Map}get(e){let t=this.root;for(let i=0;i<e.length;i++)if(t=t.get(e[i]),!t)return;return t}set(e,t){let i=this.root,r;for(r=0;r<e.length-1;r++){let n=i.get(e[r]);n||(n=new Map,i.set(e[r],n)),i=n}i.set(e[r],t)}delete(e){let t=[this.root],i=this.root;for(let n=0;n<e.length-1;n++)t.push(i=i.get(e[n]));let r=t.length-1;for(t[r].delete(e[r]);--r>-1&&t[r].get(e[r]).size===0;)t[r].delete(e[r])}};function w(s,e){return new S(s,e)}var T=(...s)=>(typeof s[0]=="function"?j:w)(s[0],s.length>1?s[1]:u);var C=s=>e=>T(e,s);var O=require("rxjs");var V=()=>s=>{let e=null;return new O.Observable(t=>{if(e){e.inner=t;let r=e;return()=>{r.inner===t&&r.unsubscribe()}}let i=new O.Subscriber({next(r){r===l?(e=i,i.inner.error(r),e=null,i.inner===t&&i.unsubscribe()):i.inner.next(r)},error(r){i.inner.error(r)},complete(){i.inner.complete()}});return i.inner=t,s.subscribe(i),()=>{i.inner===t&&i.unsubscribe()}})};var v=require("rxjs");var N=()=>s=>new v.Observable(e=>{let t,i=()=>{t=new v.Subscriber({next(r){e.next(r)},error(r){r===l?(e.next(r),i()):e.error(r)},complete(){e.complete()}}),s.subscribe(t)};return i(),()=>{t.unsubscribe()}});
//# sourceMappingURL=rxstate.core.cjs.production.min.js.map
